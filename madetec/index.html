<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Madetec</title>
    <style>
        /* Mantenha seus estilos atuais (nÃ£o mudei nada aqui) */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { height: 100vh; background-color: #f5f5f5; }
        #chat-container { display: flex; flex-direction: column; height: 100%; padding: 10px; }
        #chat-messages { flex: 1; overflow-y: auto; background: white; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .message { margin-bottom: 15px; }
        .user-message { color: #1a73e8; text-align: right; }
        .ai-message { color: #202124; text-align: left; }
        #input-area { display: flex; padding: 10px; background: white; border-radius: 8px; }
        #message-input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 24px; resize: none; }
        #send-button { margin-left: 10px; padding: 0 16px; background: #1a73e8; color: white; border: none; border-radius: 24px; cursor: pointer; }
        .pdf-link { display: inline-block; padding: 8px 12px; background: #f0f7ff; border-radius: 4px; color: #1a73e8; text-decoration: none; margin-top: 5px; }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="chat-messages"></div>
        <div id="input-area">
            <textarea id="message-input" placeholder="Digite sua mensagem..." rows="1"></textarea>
            <button id="send-button">Enviar</button>
        </div>
    </div>

    <script>
        // ConfiguraÃ§Ã£o bÃ¡sica
        const sessionId = 'session-' + Math.random().toString(36).substr(2, 9);
        
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            
            // Envio de mensagem
            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Auto-resize
            messageInput.addEventListener('input', () => {
                messageInput.style.height = 'auto';
                messageInput.style.height = messageInput.scrollHeight + 'px';
            });

            async function sendMessage() {
                const message = messageInput.value.trim();
                if (!message || sendButton.disabled) return;
                
                addMessage('VocÃª', message, 'user-message');
                messageInput.value = '';
                messageInput.style.height = 'auto';
                sendButton.disabled = true;
                
                try {
                    const response = await fetch('https://api.muvecom.com.br/v1/resp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sessionId, chatInput: message })
                    });
                    
                    const data = await response.json();
                    
                    // Tratamento universal (texto ou PDF)
                    if (data.text) addMessage('Madalena', data.text, 'ai-message');
                    if (data.pdfUrl) addPdfLink(data.pdfUrl, data.pdfName || 'CatÃ¡logo.pdf');
                    
                } catch (error) {
                    addMessage('Sistema', 'Erro ao enviar mensagem', 'error-message');
                } finally {
                    sendButton.disabled = false;
                }
            }
            
            function addMessage(sender, text, className) {
                const msgDiv = document.createElement('div');
                msgDiv.className = `message ${className}`;
                msgDiv.innerHTML = `<div class="message-sender">${sender}</div><div>${text}</div>`;
                chatMessages.appendChild(msgDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            function addPdfLink(url, fileName) {
                const link = document.createElement('a');
                link.href = url;
                link.className = 'pdf-link';
                link.textContent = `ðŸ“„ ${fileName}`;
                link.target = '_blank';
                chatMessages.appendChild(link);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });
    </script>
</body>
</html>
